# 能源管理系统 - 用户操作手册

欢迎使用能源管理系统！本手册将指导您如何使用系统的各项功能。

## 目录

1. [系统简介](#系统简介)
2. [登录系统](#登录系统)
3. [仪表盘](#仪表盘)
4. [历史数据查询](#历史数据查询)
5. [报警管理](#报警管理)
6. [系统设置](#系统设置)
7. [常见问题](#常见问题)

---

## 系统简介

能源管理系统是一个实时监控和管理生产线能源消耗的Web应用程序。

### 主要功能

- 实时监控设备状态和能耗
- 可视化能耗趋势图表
- 报警管理和通知
- 历史数据查询和分析
- OEE（设备综合效率）计算
- 阈值配置和管理

### 系统要求

- 现代Web浏览器（Chrome、Firefox、Edge、Safari）
- 网络连接到系统服务器
- 屏幕分辨率：1280x720或更高（推荐1920x1080）

---

## 登录系统

### 访问系统

1. 打开Web浏览器
2. 在地址栏输入系统地址：http://服务器IP:5000
3. 按Enter键访问登录页面

### 登录步骤

1. 在登录页面输入用户名和密码
2. 点击"登录"按钮
3. 登录成功后自动跳转到仪表盘

### 默认账户

系统提供以下默认账户：

| 用户名 | 密码 | 角色 | 权限 |
|--------|------|------|------|
| admin | admin123 | 管理员 | 所有权限 |
| operator | operator123 | 操作员 | 查看和确认报警 |

**安全提示**：首次登录后请立即修改默认密码！

### 登录问题

如果无法登录，请检查：
- 用户名和密码是否正确（区分大小写）
- 网络连接是否正常
- 系统服务是否运行

---

## 仪表盘

仪表盘是系统的主界面，显示所有关键信息。

### 页面布局

仪表盘分为以下几个区域：

1. 顶部导航栏 - 系统菜单和用户信息
2. 设备状态卡片 - 显示各设备实时状态
3. 能耗趋势图 - 显示能耗变化趋势
4. 最新报警列表 - 显示未确认的报警
5. OEE图表 - 显示设备综合效率
6. 生产统计 - 显示生产数据

### 设备状态卡片

系统监控三个主要设备：

#### 1. 传送带

显示信息：
- 状态：运行中/待机/故障
- 速度：当前运行速度（m/s）
- 功率：实时功率（kW）
- 累计能耗：总能耗（kWh）
- 功率负载条：可视化功率使用情况

状态指示：
- 绿色：运行中
- 灰色：待机
- 红色：故障

#### 2. 加工工位1和工位2

显示信息：
- 状态：运行中/待机/故障
- 激活状态：激活/未激活
- 功率：实时功率（kW）
- 累计能耗：总能耗（kWh）
- 功率负载条：可视化功率使用情况

### 能耗趋势图

能耗趋势图显示最近1小时的功率变化：

- 蓝色线：传送带功率
- 橙色线：工位1功率
- 红色线：工位2功率

图表功能：
- 鼠标悬停查看具体数值
- 自动更新（每2秒）
- 平滑曲线显示

### 最新报警列表

显示最近5条未确认的报警：

报警信息包括：
- 报警级别（警告/严重/紧急）
- 报警消息
- 设备ID
- 发生时间

报警级别颜色：
- 黄色：警告
- 橙色：严重
- 红色：紧急

操作：
- 点击报警可查看详情
- 点击"确认"按钮确认报警

### OEE图表

OEE（设备综合效率）柱状图显示：

- 可用率：设备运行时间占比
- 性能率：实际产量与理论产量比
- 质量率：合格品占比
- 总OEE：三者的乘积

OEE计算公式：
```
OEE = 可用率 × 性能率 × 质量率
```

### 生产统计

显示当前生产数据：

- 产品计数：已生产的产品总数
- 不良品：检测出的不良品数量
- 运行时间：设备运行的累计时间
- 停机时间：设备停机的累计时间
- 合格率：合格品占总产量的百分比

### 数据刷新

仪表盘数据每2秒自动刷新一次，无需手动刷新页面。

---

## 历史数据查询

历史数据页面允许您查询和分析过去的能耗数据。

### 访问历史数据

1. 点击顶部导航栏的"历史数据"
2. 进入历史数据查询页面

### 查询步骤

1. 选择设备
   - 传送带
   - 加工工位1
   - 加工工位2
   - 全部设备

2. 选择时间范围
   - 点击"开始时间"选择器
   - 选择开始日期和时间
   - 点击"结束时间"选择器
   - 选择结束日期和时间

3. 点击"查询"按钮

### 查看结果

查询结果以图表和表格形式显示：

#### 图表视图
- 折线图显示功率变化趋势
- 柱状图显示能耗统计
- 鼠标悬停查看详细数值

#### 表格视图
- 显示详细的数据记录
- 包含时间戳、功率、能耗等信息
- 支持分页浏览

### 数据导出

1. 查询数据后，点击"导出CSV"按钮
2. 选择保存位置
3. 数据将以CSV格式保存，可用Excel打开

### 快速时间选择

系统提供快捷时间选项：

- 最近1小时
- 最近24小时
- 最近7天
- 最近30天
- 自定义时间范围

---

## 报警管理

报警管理页面显示所有报警记录，并允许您确认和管理报警。

### 访问报警管理

1. 点击顶部导航栏的"报警"
2. 进入报警管理页面

### 报警列表

报警列表显示所有报警记录：

显示信息：
- 报警级别（图标和颜色标识）
- 报警消息
- 设备ID
- 发生时间
- 确认状态
- 确认人和确认时间（如已确认）

### 筛选报警

使用筛选功能快速找到特定报警：

1. 按设备筛选
   - 选择设备下拉菜单
   - 选择特定设备或"全部设备"

2. 按级别筛选
   - 选择级别下拉菜单
   - 选择警告/严重/紧急或"全部级别"

3. 按状态筛选
   - 未确认：显示待处理的报警
   - 已确认：显示已处理的报警
   - 全部：显示所有报警

4. 按时间筛选
   - 选择时间范围
   - 查看特定时间段的报警

### 确认报警

确认报警表示您已知晓并处理该报警：

1. 在报警列表中找到要确认的报警
2. 点击报警行右侧的"确认"按钮
3. 报警状态变为"已确认"
4. 系统记录确认人和确认时间

### 批量确认

如果有多个报警需要确认：

1. 勾选要确认的报警（复选框）
2. 点击页面顶部的"批量确认"按钮
3. 确认操作

### 报警通知

系统提供多种报警通知方式：

#### 浏览器通知
- 首次访问时请允许浏览器通知权限
- 新报警发生时会弹出浏览器通知
- 点击通知可跳转到报警详情

#### 页面内弹窗
- 新报警自动在页面右上角弹出
- 显示报警详情
- 可直接在弹窗中确认报警

#### 声音提示
- 紧急报警会播放提示音
- 可在设置中关闭声音提示

### 报警统计

报警管理页面显示报警统计信息：

- 按级别统计：各级别报警数量
- 按设备统计：各设备报警数量
- 按时间统计：不同时间段的报警趋势

---

## 系统设置

系统设置页面允许管理员配置系统参数。

**注意**：此功能仅管理员可访问。

### 访问系统设置

1. 以管理员身份登录
2. 点击顶部导航栏的"设置"
3. 进入系统设置页面

### 阈值配置

阈值用于触发报警，当监控值超过阈值时系统会产生报警。

#### 查看阈值

阈值列表显示所有配置的阈值：

- 设备ID
- 参数名称
- 阈值
- 报警级别
- 启用状态

#### 修改阈值

1. 在阈值列表中找到要修改的阈值
2. 点击"编辑"按钮
3. 在弹出的对话框中修改：
   - 阈值：输入新的阈值数值
   - 报警级别：选择警告/严重/紧急
   - 启用状态：勾选或取消勾选
4. 点击"保存"按钮

#### 添加新阈值

1. 点击页面顶部的"添加阈值"按钮
2. 填写阈值信息：
   - 设备ID：选择设备
   - 参数名称：选择要监控的参数
   - 阈值：输入阈值数值
   - 报警级别：选择级别
   - 启用状态：勾选启用
3. 点击"保存"按钮

#### 删除阈值

1. 在阈值列表中找到要删除的阈值
2. 点击"删除"按钮
3. 确认删除操作

### 用户管理

管理员可以管理系统用户。

#### 查看用户

用户列表显示所有系统用户：

- 用户名
- 角色（管理员/操作员）
- 创建时间
- 最后登录时间
- 状态（启用/禁用）

#### 添加用户

1. 点击"添加用户"按钮
2. 填写用户信息：
   - 用户名：3-20个字符
   - 密码：至少6个字符
   - 角色：选择管理员或操作员
3. 点击"保存"按钮

#### 修改用户

1. 在用户列表中找到要修改的用户
2. 点击"编辑"按钮
3. 修改用户信息
4. 点击"保存"按钮

#### 重置密码

1. 在用户列表中找到用户
2. 点击"重置密码"按钮
3. 输入新密码
4. 点击"确认"按钮

#### 禁用/启用用户

1. 在用户列表中找到用户
2. 点击"禁用"或"启用"按钮
3. 确认操作

### 系统参数

配置系统运行参数：

- 数据刷新间隔：设置仪表盘数据刷新频率（秒）
- 报警去重时间：相同报警的去重时间窗口（分钟）
- 会话超时时间：用户无操作自动登出时间（分钟）

修改参数后点击"保存"按钮使更改生效。

---

## 常见问题

### 1. 无法登录系统

**问题**：输入用户名和密码后无法登录

**解决方案**：
- 检查用户名和密码是否正确（区分大小写）
- 确认账户未被禁用
- 清除浏览器缓存和Cookie
- 联系管理员重置密码

### 2. 数据不更新

**问题**：仪表盘数据显示但不更新

**解决方案**：
- 刷新浏览器页面（F5）
- 检查网络连接
- 检查数据采集程序是否运行
- 查看浏览器控制台是否有错误信息

### 3. 看不到历史数据

**问题**：查询历史数据时没有结果

**解决方案**：
- 确认选择的时间范围内有数据
- 检查设备选择是否正确
- 确认数据采集程序已运行一段时间
- 联系管理员检查数据库

### 4. 报警通知不显示

**问题**：新报警发生时没有通知

**解决方案**：
- 检查浏览器通知权限是否允许
- 确认报警通知功能已启用
- 检查浏览器是否静音
- 刷新页面重新加载

### 5. 图表显示异常

**问题**：图表不显示或显示错误

**解决方案**：
- 刷新浏览器页面
- 清除浏览器缓存
- 使用Chrome或Firefox浏览器
- 检查网络连接

### 6. 无法导出数据

**问题**：点击导出按钮没有反应

**解决方案**：
- 检查浏览器下载设置
- 允许浏览器下载文件
- 检查磁盘空间是否充足
- 尝试使用其他浏览器

### 7. 会话超时

**问题**：使用过程中突然退出登录

**解决方案**：
- 这是正常的安全机制（30分钟无操作自动登出）
- 重新登录即可
- 管理员可在设置中调整超时时间

### 8. 权限不足

**问题**：无法访问某些功能

**解决方案**：
- 确认您的用户角色和权限
- 系统设置功能仅管理员可访问
- 联系管理员分配相应权限

---

## 技术支持

如果遇到本手册未涵盖的问题，请：

1. 查看系统日志文件（logs目录）
2. 联系系统管理员
3. 查阅项目README.md文档
4. 检查KepServer和PLC连接状态

---

## 附录

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| F5 | 刷新页面 |
| Ctrl + F | 页面内搜索 |
| Esc | 关闭弹窗 |

### 浏览器兼容性

| 浏览器 | 最低版本 | 推荐版本 |
|--------|---------|---------|
| Chrome | 90+ | 最新版 |
| Firefox | 88+ | 最新版 |
| Edge | 90+ | 最新版 |
| Safari | 14+ | 最新版 |

### 系统架构

```
用户浏览器 → Web应用 → 数据库
                ↓
         数据采集程序
                ↓
           KepServer
                ↓
            PLC设备
```

---

**文档版本**：1.0  
**最后更新**：2025-12-01  
**适用系统版本**：1.0

感谢使用能源管理系统！
