# ç¯å¢ƒé—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°
Python 3.14 ä¸ SQLAlchemy å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå¯¼è‡´æµ‹è¯•æ— æ³•è¿è¡Œã€‚

## è§£å†³æ­¥éª¤

### 1. å‡çº§ SQLAlchemy
```bash
pip install --upgrade sqlalchemy
```
- ä»ç‰ˆæœ¬ 2.0.23 å‡çº§åˆ° 2.0.44
- è§£å†³äº† Python 3.14 çš„å…¼å®¹æ€§é—®é¢˜

### 2. å®‰è£… cryptography åŒ…
```bash
pip install cryptography
```
- MySQL æ•°æ®åº“è®¤è¯éœ€è¦æ­¤åŒ…
- æ”¯æŒ sha256_password å’Œ caching_sha2_password è®¤è¯æ–¹æ³•

## éªŒè¯ç»“æœ

### âœ… ç¯å¢ƒå·²ä¿®å¤
```bash
# æµ‹è¯• SQLAlchemy å¯¼å…¥
python -c "from sqlalchemy import create_engine; print('SQLAlchemyå¯¼å…¥æˆåŠŸ')"
# è¾“å‡º: SQLAlchemyå¯¼å…¥æˆåŠŸ

# æµ‹è¯• Flask åº”ç”¨å¯¼å…¥
python -c "import sys; sys.path.insert(0, 'web_app'); from app import app; print('Flaskåº”ç”¨å¯¼å…¥æˆåŠŸ')"
# è¾“å‡º: Flaskåº”ç”¨å¯¼å…¥æˆåŠŸ

# è¿è¡Œ pytest æµ‹è¯•
python -m pytest web_app/test_api_endpoints_pytest.py::test_import_app -v
# è¾“å‡º: 1 passed
```

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
python -m pytest web_app/test_api_endpoints_pytest.py -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
```bash
# è®¤è¯æµ‹è¯•
python -m pytest web_app/test_api_endpoints_pytest.py::TestAuthenticationEndpoints -v

# æƒé™æ§åˆ¶æµ‹è¯•
python -m pytest web_app/test_api_endpoints_pytest.py::TestAuthorizationEndpoints -v

# è®¾å¤‡APIæµ‹è¯•
python -m pytest web_app/test_api_endpoints_pytest.py::TestDeviceAPIEndpoints -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
python -m pytest web_app/test_api_endpoints_pytest.py::TestAuthenticationEndpoints::test_login_endpoint_exists -v
```

## æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®ä¿æ•°æ®åº“å·²åˆå§‹åŒ–
```bash
python python_client/init_database.py
```

### 2. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
æµ‹è¯•éœ€è¦ä»¥ä¸‹ç”¨æˆ·ï¼š
- ç®¡ç†å‘˜: username='admin', password='admin123'
- æ™®é€šç”¨æˆ·: username='user', password='user123'

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š
```bash
python python_client/create_test_users.py
```

æˆ–è€…æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­åˆ›å»ºã€‚

### 3. å¯åŠ¨æ•°æ®åº“æœåŠ¡
ç¡®ä¿ MySQL æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
python python_client/test_connection.py
```

## å½“å‰çŠ¶æ€

### âœ… å·²è§£å†³
- Python 3.14 ä¸ SQLAlchemy å…¼å®¹æ€§é—®é¢˜
- cryptography åŒ…ç¼ºå¤±é—®é¢˜
- æµ‹è¯•æ¡†æ¶å¯ä»¥æ­£å¸¸è¿è¡Œ

### âš ï¸ éœ€è¦æ³¨æ„
- éƒ¨åˆ†æµ‹è¯•éœ€è¦æ•°æ®åº“ä¸­å­˜åœ¨æµ‹è¯•ç”¨æˆ·
- æ•°æ®åº“è¿æ¥é…ç½®éœ€è¦æ­£ç¡®ï¼ˆ.env æ–‡ä»¶ï¼‰
- æŸäº›æµ‹è¯•å¯èƒ½å› ä¸ºæ•°æ®åº“ä¸ºç©ºè€Œå¤±è´¥

### ğŸ“ SQLAlchemy 2.0 è­¦å‘Š
æµ‹è¯•è¿è¡Œæ—¶ä¼šçœ‹åˆ°ä»¥ä¸‹è­¦å‘Šï¼š
```
MovedIn20Warning: The declarative_base() function is now available as 
sqlalchemy.orm.declarative_base(). (deprecated since: 2.0)
```

è¿™æ˜¯å› ä¸ºä»£ç ä½¿ç”¨äº†æ—§çš„ APIã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ `python_client/models.py` æ¥æ¶ˆé™¤ï¼š
```python
# æ—§ä»£ç 
from sqlalchemy.ext.declarative import declarative_base
Base = declarative_base()

# æ–°ä»£ç 
from sqlalchemy.orm import declarative_base
Base = declarative_base()
```

## æ€»ç»“

ç¯å¢ƒé—®é¢˜å·²å®Œå…¨è§£å†³ï¼ç°åœ¨å¯ä»¥ï¼š
- âœ… æ­£å¸¸å¯¼å…¥ SQLAlchemy
- âœ… æ­£å¸¸å¯¼å…¥ Flask åº”ç”¨
- âœ… è¿è¡Œ pytest æµ‹è¯•
- âœ… ä½¿ç”¨æ‰€æœ‰æ•°æ®åº“åŠŸèƒ½

æµ‹è¯•æ¡†æ¶å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹è¿›è¡Œå®Œæ•´çš„APIç«¯ç‚¹æµ‹è¯•ã€‚
